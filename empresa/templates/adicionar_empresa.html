{% extends 'base_login.html' %}
{% load static %}

{% block menu %}
<nav class="navbar navbar-expand-lg">
    <div class="container-fluid">
        <a class="navbar-brand" href="#">
            <div class="icon-container">
                <img src="{% static 'img/icon.png' %}" alt="Logo" class="navbar img.icon-img" style="max-width: 65%; height: 65px; margin-left: 20px; margin-top: 15px;">
            </div>
        </a>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav custom-nav-link">
                <li class="nav-item">
                    <a class="nav-link text-center" href="{% url 'menu_srv' %}" style="display: flex; flex-direction: column; align-items: center;">
                        <img src="{% static 'img/voltar.png' %}" alt="voltar" style="width: 30px; height: 30px; margin-left: 100px; filter: invert(1);">
                        <span style="margin-top: 5px; margin-left: 100px;">Retornar</span>
                    </a>
                </li>
            </ul>
        </div>
    </div>
		<br>
	<br>
	<br>
	<br>
</nav>
{% endblock %}

    {% block content %}
<br><br><br>
    <h2>Adicionar Empresa</h2>
    <form method="post">
        {% csrf_token %}
        {{ form.as_p }}
        <button type="submit" class="btn btn-success">Salvar</button>
    </form>

    <!-- Inclua jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- Inclua o jQuery Mask Plugin -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.16/jquery.mask.min.js"></script>

    <script>
        $(document).ready(function() {
            // Aplica a máscara para os campos de telefone
            $('#telefone1').mask('(00) 0 0000-0000');
            $('#telefone2').mask('(00) 0 0000-0000');
        });
            // Código existente para máscara e CEP aqui...
    $(document).ready(function(){
        $('#id_cep').mask('00000-000'); // Máscara para CEP
        $('#id_cnpj').mask('00.000.000/0000-00'); // Máscara para CNPJ
        $('#id_telefone').mask('(00) 0 0000-0000'); // Máscara para telefone
    });

    document.addEventListener('DOMContentLoaded', function() {
        const cepField = document.getElementById('id_cep');

        // Quando o campo CEP perder o foco, faz a requisição para a API ViaCEP
        cepField.addEventListener('blur', function() {
            const cep = cepField.value.replace(/\D/g, '');

            if (cep.length === 8) { // Verifica se o CEP tem 8 dígitos
                fetch(`https://viacep.com.br/ws/${cep}/json/`) // Corrigido: uso de crases para interpolação
                .then(response => response.json())
                .then(data => {
                    if (!('erro' in data)) {
                        document.getElementById('id_logradouro').value = data.logradouro;
                        document.getElementById('id_bairro').value = data.bairro;
                        document.getElementById('id_cidade').value = data.localidade;
                        document.getElementById('id_uf').value = data.uf;
                    } else {
                        alert('CEP não encontrado.');
                    }
                })
                .catch(error => {
                    console.error('Erro ao buscar o CEP:', error);
                    alert('Erro ao buscar o CEP.');
                });
            }
        });
    });
    </script>
{% endblock %}
